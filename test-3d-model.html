<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D 模型测试</title>
    <style>
        body {
            margin: 0;
            background: #0A0A0A;
            overflow: hidden;
        }
        #container {
            width: 100vw;
            height: 100vh;
        }
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #FFD700;
            font-family: monospace;
            font-size: 14px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="info">加载中...</div>
    <div id="container"></div>
    
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    
    <script type="module">
        import * as THREE from 'three';
        import { STLLoader } from 'three/addons/loaders/STLLoader.js';
        
        const info = document.getElementById('info');
        info.textContent = '初始化 Three.js...';
        
        // 创建场景
        const scene = new THREE.Scene();
        
        // 创建相机
        const camera = new THREE.PerspectiveCamera(
            45,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
        );
        camera.position.set(0, 0, 300);
        
        // 创建渲染器
        const renderer = new THREE.WebGLRenderer({ 
            antialias: true, 
            alpha: true 
        });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.getElementById('container').appendChild(renderer.domElement);
        
        info.textContent = '渲染器创建成功';
        
        // 添加环境光
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        
        // 添加点光源（金色）
        const pointLight1 = new THREE.PointLight(0xFFD700, 2);
        pointLight1.position.set(100, 100, 100);
        scene.add(pointLight1);
        
        const pointLight2 = new THREE.PointLight(0xD4AF37, 1.5);
        pointLight2.position.set(-100, -50, 50);
        scene.add(pointLight2);
        
        // 添加一个测试立方体（确保渲染正常）
        const testGeometry = new THREE.BoxGeometry(50, 50, 50);
        const testMaterial = new THREE.MeshBasicMaterial({ 
            color: 0xFFD700, 
            wireframe: true 
        });
        const testCube = new THREE.Mesh(testGeometry, testMaterial);
        scene.add(testCube);
        
        info.textContent = '测试立方体已添加，开始加载 STL...';
        
        // 加载 STL 模型
        const loader = new STLLoader();
        let mesh;
        
        loader.load(
            './output/青铜鼎.stl',
            function (geometry) {
                info.textContent = 'STL 加载成功！';
                
                // 移除测试立方体
                scene.remove(testCube);
                
                // 居中几何体
                geometry.center();
                geometry.computeVertexNormals();
                
                // 创建半透明黑色实体材质
                const solidMaterial = new THREE.MeshPhongMaterial({
                    color: 0x1a1a1a,
                    transparent: true,
                    opacity: 0.3,
                    shininess: 30
                });
                
                // 创建金色线框材质
                const wireframeMaterial = new THREE.MeshBasicMaterial({
                    color: 0xFFD700,
                    wireframe: true,
                    transparent: true,
                    opacity: 0.85
                });
                
                // 创建实体网格
                const solidMesh = new THREE.Mesh(geometry, solidMaterial);
                
                // 创建线框网格
                const wireframeMesh = new THREE.Mesh(geometry, wireframeMaterial);
                
                // 创建组合对象
                mesh = new THREE.Group();
                mesh.add(solidMesh);
                mesh.add(wireframeMesh);
                
                // 调整模型大小
                const box = new THREE.Box3().setFromObject(mesh);
                const size = box.getSize(new THREE.Vector3());
                const maxDim = Math.max(size.x, size.y, size.z);
                const scale = 200 / maxDim;
                mesh.scale.set(scale, scale, scale);
                
                info.textContent = `模型尺寸: ${size.x.toFixed(1)} x ${size.y.toFixed(1)} x ${size.z.toFixed(1)}`;
                
                // 初始旋转
                mesh.rotation.x = -Math.PI / 6;
                mesh.rotation.y = Math.PI / 4;
                
                scene.add(mesh);
            },
            function (progress) {
                const percent = (progress.loaded / progress.total * 100).toFixed(0);
                info.textContent = `加载中: ${percent}%`;
            },
            function (error) {
                info.textContent = '加载失败: ' + error.message;
                console.error('STL 加载错误:', error);
            }
        );
        
        // 动画循环
        function animate() {
            requestAnimationFrame(animate);
            
            // 旋转测试立方体
            testCube.rotation.x += 0.01;
            testCube.rotation.y += 0.01;
            
            // 旋转模型
            if (mesh) {
                mesh.rotation.y += 0.005;
            }
            
            renderer.render(scene, camera);
        }
        
        animate();
        
        // 响应窗口大小
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
